<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Posts</title>
    <link rel="stylesheet" href="res/style.css" />
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<header class="navbar">
    <div class="nav-logo">My Posts</div>
</header>

<main class="container" style="margin-top: 100px;">
    <h1 class="title">Posts</h1>
    <div id="posts-container"></div>
</main>

<script>
    // Your Firebase config (from your message)
    const firebaseConfig = {
        apiKey: "AIzaSyC-iYL6szyRSf5Jegqoiza2yq7FGtGgTDg",
        authDomain: "hikari-blog.firebaseapp.com",
        projectId: "hikari-blog",
        storageBucket: "hikari-blog.firebasestorage.app",
        messagingSenderId: "349415153573",
        appId: "1:349415153573:web:240f1b85ae312931c3524c",
        measurementId: "G-T2VQPL77WX"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const postsContainer = document.getElementById('posts-container');

    function formatDate(timestamp) {
        if (!timestamp) return '';
        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
        return date.toLocaleString(undefined, {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    function createPostElement(post) {
        const div = document.createElement('div');
        div.className = 'about-card';

        const contentP = document.createElement('p');
        contentP.textContent = post.content || post.text || post.body || '';

        const dateP = document.createElement('p');
        dateP.textContent = formatDate(post.createdAt || post.timestamp);
        dateP.style.fontStyle = 'italic';
        dateP.style.fontSize = '0.85rem';
        dateP.style.marginTop = '0.8rem';
        dateP.style.color = '#d3a9b9';

        div.appendChild(contentP);
        div.appendChild(dateP);

        return div;
    }

    function loadPosts() {
        postsContainer.innerHTML = 'Loading posts...';
        db.collection('posts').orderBy('createdAt', 'desc').get()
            .then(snapshot => {
                postsContainer.innerHTML = '';
                if (snapshot.empty) {
                    postsContainer.textContent = 'No posts found.';
                    return;
                }
                snapshot.forEach(doc => {
                    const post = doc.data();
                    const postElem = createPostElement(post);
                    postsContainer.appendChild(postElem);
                });
            })
            .catch(error => {
                postsContainer.textContent = 'Error loading posts.';
                console.error('Error getting posts:', error);
            });
    }

    loadPosts();
</script>

</body>
</html>

